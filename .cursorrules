# E-Learning Monorepo Rules

## üö® Prioritering

### MUST FOLLOW (Kritisch - Push wordt geblokkeerd)
- ‚ùå **NIET** wijzigen in `packages/core` (alleen via PR)
- ‚ùå **NIET** wijzigen in andere apps (niet jouw app)
- ‚ùå **NIET** pushen van `config.js`, `.env`, of andere gevoelige bestanden
- ‚ùå **NIET** nieuwe app directories aanmaken zonder toestemming
- ‚ùå **NIET** root bestanden wijzigen (`package.json`, `README.md`, etc.)
- ‚úÖ **ALTIJD** werken in je eigen app folder (zoals geconfigureerd in `.allowed-paths.json`)

### SHOULD FOLLOW (Aanbevolen - Best Practices)
- ‚úÖ Gebruik async/await voor asynchrone operaties
- ‚úÖ Gebruik try-catch voor error handling
- ‚úÖ Voeg JSDoc comments toe aan functies
- ‚úÖ Test lokaal voordat je pusht
- ‚úÖ Gebruik consistente naming conventions

---

## üìã Quick Reference Cheat Sheet

### Toegestane Wijzigingen
```
‚úÖ apps/[jouw-app]/content/*.content.json
‚úÖ apps/[jouw-app]/pages/*.js
‚úÖ apps/[jouw-app]/assets/*
‚úÖ apps/[jouw-app]/*.html
‚úÖ apps/[jouw-app]/js/*.js
```

### Verboden Wijzigingen
```
‚ùå packages/core/** (alleen via PR)
‚ùå apps/[andere-app]/** (niet jouw app)
‚ùå config.js (gevoelige data)
‚ùå .env, .env.local (gevoelige data)
‚ùå package.json, README.md (root bestanden)
‚ùå Nieuwe app directories aanmaken
```

### File Paths
- Core JavaScript: `/core/js/...` (absolute path vanaf root)
- Core pages: `/core/pages/...` (absolute path vanaf root)
- App content: `content/...` (relatief vanaf app root)
- App assets: `assets/...` (relatief vanaf app root)
- App pages: `pages/Week*LessonPage.js` (relatief vanaf app root)

---

## ü§ñ AI-specifieke Instructies (Cursor/Composer)

### VOOR je wijzigingen voorstelt:

1. **Check toegestane paden:**
   - Lees `.allowed-paths.json` in de root
   - Controleer of de gebruiker geconfigureerd is
   - Als gebruiker niet geconfigureerd is, vraag naar GitHub username
   - Controleer `allowedPaths` voor de gebruiker
   - **STEL ALLEEN wijzigingen voor in toegestane paden**

2. **Check huidige context:**
   - In welke directory werk je? (`apps/[app-naam]` of root?)
   - Welke bestanden zijn open?
   - Is dit een app-specifieke wijziging of core wijziging?

3. **Als gebruiker niet geconfigureerd is:**
   - Vraag: "Wat is je GitHub username? Ik moet dit checken in `.allowed-paths.json` om te zien welke directories je mag wijzigen."
   - Of: "Je GitHub username staat niet in `.allowed-paths.json`. Neem contact op met de beheerder om je toe te voegen."

4. **Bij twijfel:**
   - Vraag de gebruiker om bevestiging
   - Verwijs naar deze `.cursorrules`
   - Toon welke paden toegestaan zijn volgens `.allowed-paths.json`

### Wanneer wel/niet core wijzigen:

**NIET wijzigen (app-specifieke wijziging):**
- Nieuwe content toevoegen ‚Üí `apps/[app]/content/*.json`
- Nieuwe pagina toevoegen ‚Üí `apps/[app]/pages/*.js`
- App-specifieke styling ‚Üí `apps/[app]/*.html` of `apps/[app]/js/*.js`

**WEL wijzigen (maar alleen via PR):**
- Nieuwe content type nodig ‚Üí `packages/core/pages/ContentRenderer.js`
- Nieuwe interactieve component ‚Üí `packages/core/js/components/interactive/`
- Core functionaliteit uitbreiden ‚Üí `packages/core/**`

**Als gebruiker core wil wijzigen:**
- Leg uit dat dit alleen via Pull Request kan
- Verwijs naar beheerder
- Stel voor om het probleem te beschrijven in een issue

---

## Structuur

- `/packages/core` - Gedeelde framework code (wijzig alleen via PR)
- `/apps/*` - Individuele e-learning apps (elke docent werkt in eigen app)
- `/game` - Research Architect game (blijft in root)
- `/research-architect` - Game source code (blijft in root)

---

## Best Practices

### Core Framework (`/packages/core`)
- **NIET wijzigen** tenzij je beheerder bent of een Pull Request maakt
- Core bevat: BaseLessonPage, ContentRenderer, alle managers, server.js, API
- Als je nieuwe functionaliteit nodig hebt in core, vraag een PR aan

### App Development (`/apps/*`)
- **Werk altijd in je eigen app folder** (bijv. `/apps/logistiek-onderzoek`)
- Wijzig alleen: content JSON bestanden, app-specifieke pagina's, assets
- Gebruik core functionaliteit via `/core/` paths in HTML

### Content Development
- Alle content staat in `content/*.content.json` bestanden
- Gebruik de standaard content types: paragraph, image, url, document, highlight, accordion, tabs, etc.
- Zie `packages/core/pages/ContentRenderer.js` voor alle beschikbare types

### Nieuwe Features
Als je een nieuwe interactieve component of functionaliteit nodig hebt:
1. **Beschrijf het probleem** in een issue of vraag het aan de beheerder
2. **Wacht op implementatie** in `packages/core`
3. **Gebruik de nieuwe feature** in je content JSON

### Testing
- Test altijd lokaal met: `cd packages/core && npm run dev`
- Open dan: `http://localhost:3000`
- Check browser console voor errors

---

## üíª JavaScript Coding Standards

### Async/Await
Gebruik altijd async/await in plaats van promises:

```javascript
// ‚úÖ GOED
async loadContent() {
    try {
        const response = await fetch(url);
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error loading content:', error);
        throw error;
    }
}

// ‚ùå SLECHT
loadContent() {
    return fetch(url)
        .then(response => response.json())
        .then(data => data)
        .catch(error => {
            console.error('Error:', error);
            throw error;
        });
}
```

### Error Handling
Gebruik altijd try-catch voor async operaties:

```javascript
// ‚úÖ GOED
async function processData() {
    try {
        const data = await fetchData();
        return process(data);
    } catch (error) {
        console.error('[FunctionName] Error:', error);
        // Fallback of error state
        return getFallbackData();
    }
}
```

### JSDoc Comments
Voeg JSDoc toe aan alle functies en classes:

```javascript
/**
 * Laad content uit JSON bestand
 * @param {string} fileName - Naam van het content bestand
 * @param {number} retries - Aantal retry pogingen (default: 3)
 * @returns {Promise<Object>} Content object
 * @throws {Error} Als content niet kan worden geladen na alle retries
 */
async loadContent(fileName, retries = 3) {
    // Implementation
}
```

### Naming Conventions
- Classes: PascalCase (`BaseLessonPage`, `ContentRenderer`)
- Functies/Methodes: camelCase (`loadContent`, `renderSection`)
- Variabelen: camelCase (`moduleId`, `contentLoaded`)
- Constants: UPPER_SNAKE_CASE (`MAX_RETRIES`, `DEFAULT_TIMEOUT`)
- Private methods: prefix met `_` (`_internalMethod`)

### Code Organization
- Gebruik static methods voor utility functies
- Gebruik instance methods voor stateful operaties
- Groepeer gerelateerde functies bij elkaar
- Voeg comments toe bij complexe logica

---

## Code Patterns

### Nieuwe Week Pagina Toevoegen:
```javascript
// apps/[app-naam]/pages/WeekXLessonPage.js
/**
 * Week X Lesson Page
 * @extends BaseLessonPage
 */
class WeekXLessonPage extends BaseLessonPage {
    constructor() {
        super('week-X', 'Week X', 'Titel van Week X');
    }
    
    /**
     * Render content sections
     * @returns {string} HTML string
     */
    renderContentSections() {
        // Gebruik ContentRenderer uit core
        const theorieContent = this.content.theorie?.content 
            ? ContentRenderer.renderContentItems(this.content.theorie.content, { enableModal: true })
            : '';
        return this.contentTemplateRenderer.renderSection(
            this.content.theorie?.title || 'Theorie',
            theorieContent,
            'book',
            'purple'
        );
    }
}
```

### Content JSON Structuur:
Gebruik de standaard content types uit het framework:
- `paragraph`, `image`, `url`, `document`, `highlight`
- `accordion`, `tabs`, `clickableSteps`
- `matchingExercise`, `trueFalseExercise`, etc.

Zie `packages/core/pages/ContentRenderer.js` voor alle beschikbare types.

---

## üöÄ Vercel Deployment Workflow

### Automatische Deployment
- Elke push naar `main` branch triggert automatisch een Vercel deployment
- Elke app heeft zijn eigen Vercel project
- Deployment gebeurt binnen 1-2 minuten na push

### Deployment Process
1. **Push naar GitHub:** `git push origin main`
2. **Husky controleert:** Pre-push hook controleert toegestane paden
3. **Vercel detecteert push:** Automatisch via GitHub integration
4. **Build & Deploy:** Vercel bouwt en deployt automatisch
5. **Live:** App is beschikbaar op `[app-naam].vercel.app`

### Vercel Configuratie
Elke app heeft zijn eigen `vercel.json`:
```json
{
  "functions": {
    "api/index.js": {
      "includeFiles": "../**/*.{html,js,json,png,jpg,jpeg,gif,svg,ico,woff,woff2,ttf,eot,docx,pdf,xlsx,vsdx}",
      "memory": 1024,
      "maxDuration": 30
    }
  }
}
```

### Belangrijke Notities
- **Root Directory:** Elke app heeft Root Directory ingesteld op `apps/[app-naam]`
- **Environment Variables:** `GEMINI_API_KEY` moet ingesteld zijn in Vercel
- **includeFiles:** Pattern `../**/*` zorgt dat `packages/core` wordt meegenomen
- **Geen Build Command nodig:** Vercel serveert statische bestanden direct

### Troubleshooting Deployment
- **Build faalt?** Check Vercel build logs
- **App laadt niet?** Check of `api/index.js` bestaat
- **Core niet beschikbaar?** Check `includeFiles` pattern in `vercel.json`
- **Environment variables?** Check Vercel project settings

---

## Git Workflow & Directory Beperkingen

### Husky Pre-Push Hook
Dit project gebruikt **Husky** om automatisch te controleren of je alleen wijzigingen pusht in je eigen app directory. De hook blokkeert de push als:
- ‚ùå Je wijzigingen in `packages/core` probeert te pushen (alleen via PR)
- ‚ùå Je wijzigingen in andere apps pusht (niet jouw app)
- ‚ùå Je gevoelige bestanden pusht (`config.js`, `.env`, etc.)
- ‚ùå Je nieuwe app directories aanmaakt zonder toestemming
- ‚ùå Je root bestanden wijzigt (`package.json`, `README.md`, etc.)
- ‚ùå Je merge commits pusht (gebruik rebase: `git pull --rebase`)

### Toegestane acties
- ‚úÖ Werk op je eigen branch: `onderwijs/docent-[naam]-[vak]`
- ‚úÖ Wijzig alleen bestanden in je eigen app folder (zoals geconfigureerd in `.allowed-paths.json`)
- ‚úÖ Core wijzigingen: maak een Pull Request
- ‚úÖ Commit messages: gebruik duidelijke beschrijvingen

### Als je push wordt geblokkeerd
1. Lees de foutmelding - deze toont welke bestanden problematisch zijn
2. Haal niet-toegestane wijzigingen uit je commit: `git reset HEAD <bestand>`
3. Commit alleen toegestane wijzigingen: `git commit --amend`
4. Push opnieuw: `git push`

**Belangrijk:** Je GitHub username moet zijn toegevoegd aan `.allowed-paths.json` met je toegestane app directories. Neem contact op met de beheerder als je niet geconfigureerd bent.

### Husky Configuratie
Het bestand `.allowed-paths.json` bevat:
- `admins`: Beheerders met volledige toegang
- `users`: Gebruikers met toegestane paden per gebruiker
- `protectedPaths`: Paden die alleen via PR gewijzigd mogen worden
- `blockedFiles`: Bestanden die nergens gepusht mogen worden
- `blockedRootFiles`: Root bestanden die niet gewijzigd mogen worden

---

## Troubleshooting
- **Scripts laden niet?** Check of paths beginnen met `/core/` voor core bestanden
- **Content laadt niet?** Check of JSON bestand in `content/` folder staat
- **Server werkt niet?** Check of je in `packages/core` directory bent en `npm run dev` gebruikt
- **Push wordt geblokkeerd?** Check `.allowed-paths.json` en je GitHub username
- **Vercel deployment faalt?** Check build logs en `vercel.json` configuratie

---

## üìù Common Mistakes to Avoid

### ‚ùå Fouten die Push Blokkeren
1. **Core wijzigen zonder PR:** Wijzigingen in `packages/core` worden geblokkeerd
2. **Andere app wijzigen:** Wijzigingen in andere apps worden geblokkeerd
3. **Config.js pushen:** Bevat gevoelige data, wordt geblokkeerd
4. **Root bestanden wijzigen:** `package.json`, `README.md` worden geblokkeerd
5. **Merge commits:** Gebruik `git pull --rebase` in plaats van merge

### ‚ö†Ô∏è Veelgemaakte Fouten
1. **Verkeerde paths:** Gebruik `/core/` voor core, relatief voor app
2. **Geen error handling:** Voeg altijd try-catch toe aan async functies
3. **Geen JSDoc:** Voeg documentatie toe aan functies
4. **Niet testen lokaal:** Test altijd voordat je pusht
5. **Inconsistente naming:** Volg naming conventions

---

## üîó Handige Links

- Content Types: `packages/core/pages/ContentRenderer.js`
- Base Lesson Page: `packages/core/pages/BaseLessonPage.js`
- Vercel Setup: `VERCEL_SETUP_GUIDE.md`
- Husky Config: `.allowed-paths.json`
